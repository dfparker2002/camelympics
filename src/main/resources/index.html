<?xml version="1.0" encoding="UTF-8"?>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Camel #Olympics Image Loader - www.ofbizian.com</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            slideShow();
            app.start();
            if (!window.WebSocket) {
                alert("WebSocket not supported by this browser");
            }
        });

        function slideShow() {
            $('#gallery a').css({opacity:0.0});
            $('#gallery a:first').css({opacity:1.0});
            $('#gallery .caption').css({opacity:0.7});
            $('#gallery .caption').css({width:$('#gallery a').find('img').css('width')});
            $('#gallery .content').html($('#gallery a:first').find('img').attr('rel')).animate({opacity:0.7}, 400);
        }

        function gallery(data) {
            var current = ($('#gallery a.show') ? $('#gallery a.show') : $('#gallery a:first'));
            var next = ((current.next().length) ? ((current.next().hasClass('caption'))
                    ? $('#gallery a:first') : current.next()) : $('#gallery a:first'));

            var tweet = jQuery.parseJSON(data);
            var startDate = new Date(tweet.startDate);
            $('#startDate').text(startDate.getDate() + "/" + (startDate.getMonth() + 1) + "/" + startDate.getFullYear());
            $('#tweetCount').text(tweet.tweetCount);
            $('#imageCount').text(tweet.imageCount);


            next.attr('href', tweet.url + ':large');
            next.attr('target', '_blank');
            next.html('<img src="' + tweet.url + ':large" width="'+ tweet.width + '" height="' + tweet.height + '" title="" alt="" rel="<h3>' + tweet.name + '</h3>' + tweet.text + '"/>');

            var caption = next.find('img').attr('rel');
            next.css({opacity:0.0}).addClass('show').animate({opacity:1.0}, 1000);
            current.animate({opacity:0.0}, 1000).removeClass('show');
            current.attr('href', '#');
            current.attr('target', '');

            $('#gallery .caption').css({width:tweet.width});
            $('#gallery .caption').animate({opacity:0.0}, { queue:false, duration:50 }).animate({height:'1px'}, { queue:true, duration:300 });
            $('#gallery .caption').animate({opacity:0.7}, 100).animate({height:'60px'}, 500);
            $('#gallery .content').html(caption);
        }


        var app = {
            start:function () {
                var location = "ws://localhost:8080/camelympics";
                this._ws = new WebSocket(location);
                this._ws.onmessage = this._onmessage;
                this._ws.onclose = this._onclose;
            },

            _onmessage:function (m) {
                if (m.data) {
                    gallery(m.data);
                }
            },

            _onclose:function (m) {
                this._ws = null;
            }

        };
    </script>
    <style type='text/css'>
        .clear {
            clear: both
        }

        p span {
            font-weight:bold;
        }
        #gallery {
            position: relative;
            height: 360px
        }

        #gallery a {
            float: left;
            position: absolute;
        }

        #gallery a img {
            border: none;
        }

        #gallery a.show {
            z-index: 500
        }

        #gallery .caption {
            z-index: 600;
            background-color: #000;
            color: #ffffff;
            height: 60px;
            width: 100%;
            position: relative;
            bottom: 0;
        }

        #gallery .caption .content {
            margin: 5px
        }

        #gallery .caption .content h3 {
            margin: 0;
            padding: 0;
            color: #1DCCEF;
        }
    </style>
</head>
<body>
<p>Real time twitter picture loader powered by Apache Camel. With its 0.2 fps it is enough to keep you up-to-date with the most interesting pictures around the <span>#Olympics</span> -:) </br>Since <span id="startDate">LOADING</span> processed <span id="tweetCount">LOADING</span> tweets and <span id="imageCount">LOADING</span> images. Read about it at <a target="_blank" href="http://www.ofbizian.com/">here</a></p>
<div id="gallery">
    <a href="#" class="show" target=""><img src="http://upload.wikimedia.org/wikipedia/en/thumb/b/b1/Olympic_Rings.svg/800px-Olympic_Rings.svg.png" width="800" height="400" title="" alt="" rel="<h3>www.ofbizian.com</h3>Camel #Olympics Image Loader"/></a>
    <a href="#"></a>
    <div class="caption">
        <div class="content"></div>
    </div>
    <div style="clear: both;"></div>
</div>
</body>
</html>
